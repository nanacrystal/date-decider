<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Date Decider</title>

  <style>
    :root {
      --primary: #78b4ff;
      --secondary: #ff96d2;
      --accent: #8cffd2;
      --bg: #f8f9ff;
      --text: #14161e;
      --muted: #62667a;
      --glass: rgba(255, 255, 255, 0.75);
      --border: rgba(20, 22, 30, 0.08);
      --radius: 24px;
      --shadow: 0 12px 34px rgba(20, 22, 30, 0.06);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* Prevent body scroll, scroll inside tabs */
    }

    /* Animated Background */
    .bg-elements {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      filter: blur(60px);
      opacity: 0.6;
    }
    .blob {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      animation: float 20s infinite alternate ease-in-out;
    }
    .b1 { background: var(--primary); top: -10%; left: -10%; }
    .b2 { background: var(--secondary); bottom: 10%; right: -10%; animation-delay: -5s; }
    .b3 { background: var(--accent); top: 40%; left: 30%; animation-delay: -10s; }

    @keyframes float {
      from { transform: translate(0,0) scale(1); }
      to { transform: translate(100px, 50px) scale(1.2); }
    }

    /* App Header */
    header {
      padding: calc(env(safe-area-inset-top) + 15px) 20px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .logo { 
        width: 32px; height: 32px; background: white; 
        display: grid; place-items: center; border-radius: 10px;
        box-shadow: var(--shadow); font-size: 18px;
    }

    /* Tab Container */
    main {
      flex: 1;
      position: relative;
      overflow-y: auto;
      padding: 20px;
      padding-bottom: 100px; /* Space for nav */
    }

    .tab-content {
      display: none;
      animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .tab-content.active { display: block; }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Card Styling */
    .card {
      background: var(--glass);
      backdrop-filter: blur(15px);
      border: 1px solid white;
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    h1 { font-size: 28px; margin: 0 0 10px; letter-spacing: -0.5px; }
    p { color: var(--muted); line-height: 1.5; font-size: 15px; }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .btn-primary { 
      background: var(--text); 
      color: white; 
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .btn-secondary { background: white; color: var(--text); border: 1px solid var(--border); }
    .btn:active { transform: scale(0.97); opacity: 0.8; }

    /* Bottom Navigation */
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      padding: 10px 20px calc(env(safe-area-inset-bottom) + 10px);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 11px;
      font-weight: 600;
      transition: 0.2s;
    }
    .nav-item.active { color: var(--primary); }
    .nav-icon { font-size: 22px; }

    /* Result Animation */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(5px); }
      50% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
      100% { transform: translateX(0); }
    }
    .shaking { animation: shake 0.2s infinite; }

    /* Timeline */
    .timeline { display: flex; flex-direction: column; gap: 12px; margin-top: 15px; }
    .slot {
      display: flex; gap: 15px; padding: 12px;
      background: rgba(255,255,255,0.4);
      border-radius: 14px; border: 1px solid rgba(255,255,255,0.5);
    }
    .time { font-weight: 800; font-size: 12px; min-width: 80px; color: var(--primary); }
    .act { font-size: 13px; color: var(--text); }

    /* Confetti Canvas */
    #confetti {
      position: fixed; inset: 0; pointer-events: none; z-index: 99;
    }
  </style>
</head>
<body>

  <div class="bg-elements">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <canvas id="confetti"></canvas>

  <header>
    <div class="brand">
      <div class="logo">â™¥</div>
      <div style="font-weight: 800; font-size: 17px;">Date Decider</div>
    </div>
    <div style="font-size: 12px; opacity: 0.5;" id="dateDisplay"></div>
  </header>

  <main>
    <section id="tab-story" class="tab-content active">
      <div class="card">
        <h1>The Ritual</h1>
        <p>No more "I don't know, what do you want to do?"</p>
        <p>Tomorrow is a curated experience. We've defined two paths. All you have to do is let destiny pick the vibe.</p>
        <button class="btn btn-primary" onclick="switchTab('decider')">Go to Decider â†’</button>
      </div>
      <div class="card" style="background: rgba(120, 180, 255, 0.1);">
        <h3 style="margin-top:0">The Saturday Rule</h3>
        <p>We sleep in until <b>9:30 AM</b>. No alarms, no stress. The plan only starts when we're ready.</p>
      </div>
    </section>

    <section id="tab-decider" class="tab-content">
      <div class="card" id="deciderCard" style="text-align: center; padding: 40px 20px;">
        <div id="deciderPlaceholder">
          <div style="font-size: 50px; margin-bottom: 20px;">ðŸŽ²</div>
          <h2>Ready to decide?</h2>
          <p>Tap the button to flip the digital coin for tomorrow's vibe.</p>
          <button class="btn btn-primary" onclick="runDecider()">Decide My Day</button>
        </div>
        
        <div id="deciderResult" style="display: none;">
          <div style="text-transform: uppercase; font-size: 12px; font-weight: 800; color: var(--primary); letter-spacing: 1px;">Selected Vibe</div>
          <h1 id="resultTitle" style="font-size: 40px; margin: 10px 0;">---</h1>
          <p id="resultDesc">---</p>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="switchTab('plan')">View Full Plan</button>
            <button class="btn btn-secondary" onclick="runDecider()">Reroll</button>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-plan" class="tab-content">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
          <div>
            <h2 id="planTitle">No plan yet</h2>
            <p id="planSubtitle">Go to the Decider tab first!</p>
          </div>
          <button class="logo" onclick="copyPlan()" style="border:none; cursor:pointer">ðŸ“‹</button>
        </div>
        
        <div class="timeline" id="timeline">
          </div>
      </div>
      <button class="btn btn-secondary" onclick="resetApp()">Reset All</button>
    </section>
  </main>

  <nav>
    <button class="nav-item active" onclick="switchTab('story')" id="nav-story">
      <span class="nav-icon">ðŸ“–</span>
      <span>Story</span>
    </button>
    <button class="nav-item" onclick="switchTab('decider')" id="nav-decider">
      <span class="nav-icon">âœ¨</span>
      <span>Decider</span>
    </button>
    <button class="nav-item" onclick="switchTab('plan')" id="nav-plan">
      <span class="nav-icon">ðŸ“…</span>
      <span>Plan</span>
    </button>
  </nav>

  <script>
    // Data
    const OPTIONS = [
      {
        id: 'out',
        name: 'Out Date',
        emoji: 'ðŸ™ï¸',
        desc: 'Getting dressed up, stepping out, and embracing the city energy.',
        timeline: [
          ["9:30â€“10:15", "Gentle wake-up & cuddles."],
          ["10:30â€“12:00", "Brunch mission at a cozy cafe."],
          ["12:00â€“15:00", "Adventure: Bookstore or Gallery."],
          ["15:00â€“17:00", "Park walk and snacks."],
          ["19:00â€“21:00", "Dinner with zero phone use."],
          ["21:00â€“Late", "Night walk & recap."]
        ]
      },
      {
        id: 'home',
        name: 'Home Sanctuary',
        emoji: 'ðŸ ',
        desc: 'Turning the house into a cozy private universe of comfort.',
        timeline: [
          ["9:30â€“11:00", "Super slow morning in bed."],
          ["11:00â€“12:30", "Homemade brunch & great music."],
          ["13:00â€“15:00", "Gaming or Puzzle session."],
          ["15:00â€“17:00", "Afternoon nap & slow kisses."],
          ["18:00â€“20:00", "Cook a new recipe together."],
          ["20:00â€“Late", "Movies & skincare ritual."]
        ]
      }
    ];

    let currentChoice = JSON.parse(localStorage.getItem('lastDateChoice'));

    // Navigation logic
    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      document.getElementById(`tab-${tabId}`).classList.add('active');
      document.getElementById(`nav-${tabId}`).classList.add('active');
      
      // Auto-populate plan if switching to plan tab
      if (tabId === 'plan' && currentChoice) renderPlan(currentChoice);
    }

    // Decider logic
    function runDecider() {
      const card = document.getElementById('deciderCard');
      const placeholder = document.getElementById('deciderPlaceholder');
      const resultView = document.getElementById('deciderResult');
      
      placeholder.style.display = 'none';
      resultView.style.display = 'none';
      card.classList.add('shaking');

      if (navigator.vibrate) navigator.vibrate([50, 50, 50]);

      setTimeout(() => {
        card.classList.remove('shaking');
        currentChoice = OPTIONS[Math.floor(Math.random() * OPTIONS.length)];
        localStorage.setItem('lastDateChoice', JSON.stringify(currentChoice));
        
        document.getElementById('resultTitle').textContent = currentChoice.emoji + " " + currentChoice.name;
        document.getElementById('resultDesc').textContent = currentChoice.desc;
        
        resultView.style.display = 'block';
        launchConfetti();
      }, 800);
    }

    function renderPlan(choice) {
      document.getElementById('planTitle').textContent = choice.name;
      document.getElementById('planSubtitle').textContent = "Full schedule for tomorrow";
      
      const tl = document.getElementById('timeline');
      tl.innerHTML = choice.timeline.map(item => `
        <div class="slot">
          <div class="time">${item[0]}</div>
          <div class="act">${item[1]}</div>
        </div>
      `).join('');
    }

    function resetApp() {
      localStorage.removeItem('lastDateChoice');
      location.reload();
    }

    async function copyPlan() {
      if(!currentChoice) return;
      const text = `${currentChoice.name} Plan:\n` + currentChoice.timeline.map(i => `${i[0]}: ${i[1]}`).join('\n');
      await navigator.clipboard.writeText(text);
      alert('Plan copied to clipboard!');
    }

    // Confetti Effect
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let particles = [];
    
    function launchConfetti() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      particles = [];
      for(let i=0; i<100; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: canvas.height + 10,
          color: `hsl(${Math.random() * 360}, 70%, 60%)`,
          size: Math.random() * 8 + 4,
          velX: Math.random() * 6 - 3,
          velY: -(Math.random() * 15 + 10)
        });
      }
      animateConfetti();
    }

    function animateConfetti() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach((p, i) => {
        p.x += p.velX;
        p.y += p.velY;
        p.velY += 0.4;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, p.size, p.size);
      });
      if(particles.length > 0 && particles[0].y < canvas.height + 100) {
        requestAnimationFrame(animateConfetti);
      }
    }

    // Init
    document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    if(currentChoice) {
        // If returning user, show their result
        document.getElementById('deciderPlaceholder').style.display = 'none';
        document.getElementById('deciderResult').style.display = 'block';
        document.getElementById('resultTitle').textContent = currentChoice.emoji + " " + currentChoice.name;
        document.getElementById('resultDesc').textContent = currentChoice.desc;
    }
  </script>
</body>
</html>
